{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-container\">\r\n    <view class=\"login-header\">\r\n      <view class=\"logo-container\">\r\n        <view class=\"brain-logo\">\r\n          <image src=\"/static/logo.png\" mode=\"aspectFit\"></image>\r\n        </view>\r\n      </view>\r\n      <text class=\"app-title\">智能学习助手</text>\r\n    </view>\r\n\r\n    <view class=\"login-form\">\r\n      <view class=\"form-item\">\r\n        <input\r\n          class=\"form-input\"\r\n          type=\"text\"\r\n          v-model=\"loginForm.username\"\r\n          placeholder=\"输入您的用户名\"\r\n          placeholder-style=\"color: #999\"\r\n        />\r\n      </view>\r\n\r\n      <view class=\"form-item\">\r\n        <input\r\n          class=\"form-input\"\r\n          type=\"password\"\r\n          v-model=\"loginForm.password\"\r\n          placeholder=\"输入您的密码\"\r\n          placeholder-style=\"color: #999\"\r\n        />\r\n      </view>\r\n\r\n      <view class=\"form-options\">\r\n        <view class=\"remember-container\">\r\n          <checkbox checked=\"true\" class=\"remember-checkbox\"></checkbox>\r\n          <text class=\"remember-text\">记住我</text>\r\n        </view>\r\n        <text class=\"forgot-password\" @click=\"handleForgotPassword\"\r\n          >忘记密码？</text\r\n        >\r\n      </view>\r\n\r\n      <button class=\"login-btn\" @click=\"handleLogin\">登录账号</button>\r\n\r\n      <view class=\"register-link\">\r\n        还没有账号？<text @click=\"goToRegister\" class=\"link-text\"\r\n          >立即注册</text\r\n        >\r\n      </view>\r\n\r\n      <view class=\"divider\">\r\n        <text>或使用以下方式登录</text>\r\n      </view>\r\n\r\n      <view class=\"social-login\">\r\n        <view class=\"social-btn\" @click=\"handleSocialLogin('facebook')\">\r\n          <text class=\"social-icon\">f</text>\r\n        </view>\r\n        <view class=\"social-btn\" @click=\"handleSocialLogin('google')\">\r\n          <text class=\"social-icon\">G</text>\r\n        </view>\r\n        <view class=\"social-btn\" @click=\"handleSocialLogin('apple')\">\r\n          <text class=\"social-icon\">A</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { userAPI } from \"../../api\";\r\nimport { setToken } from \"../../utils/request\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      loginForm: {\r\n        username: \"\",\r\n        password: \"\",\r\n      },\r\n      isRememberMe: true,\r\n      isLoading: false,\r\n    };\r\n  },\r\n  onLoad() {\r\n    // 检查是否有记住的用户信息\r\n    this.checkRememberedUser();\r\n  },\r\n  methods: {\r\n    // 检查是否有记住的用户信息\r\n    checkRememberedUser() {\r\n      const rememberedUser = uni.getStorageSync(\"rememberedUser\");\r\n      if (rememberedUser) {\r\n        this.loginForm.username = rememberedUser.username || \"\";\r\n      }\r\n    },\r\n\r\n    // 验证用户名格式\r\n    validateusername(username) {\r\n      // 用户名规则：4-20个字符，支持字母、数字、下划线\r\n      const usernameRegex = /^[a-zA-Z0-9_]{4,20}$/;\r\n      return usernameRegex.test(username);\r\n    },\r\n\r\n    // 处理登录\r\n    async handleLogin() {\r\n      // 表单验证\r\n      if (!this.loginForm.username) {\r\n        uni.showToast({\r\n          title: \"请输入用户名\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (!this.validateusername(this.loginForm.username)) {\r\n        uni.showToast({\r\n          title: \"用户名格式不正确，需4-20个字符，支持字母、数字、下划线\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (!this.loginForm.password) {\r\n        uni.showToast({\r\n          title: \"请输入密码\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (this.loginForm.password.length < 6) {\r\n        uni.showToast({\r\n          title: \"密码长度不能少于6位\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        this.isLoading = true;\r\n        // 调用登录API\r\n        const result = await userAPI.login({\r\n          username: this.loginForm.username,\r\n          password: this.loginForm.password,\r\n        });\r\n\r\n        // 保存token到本地存储\r\n        if (result.data) {\r\n          setToken(result.data);\r\n          \r\n          // JWT token解析：从token中提取用户名\r\n          const token = result.data;\r\n          let username = this.loginForm.username; // 默认使用登录时的用户名\r\n          \r\n          try {\r\n            // 解析JWT token (格式: header.payload.signature)\r\n            const payload = token.split('.')[1];\r\n            if (payload) {\r\n              // Base64解码payload部分\r\n              const decodedPayload = JSON.parse(decodeURIComponent(escape(atob(payload))));\r\n              // 从payload中提取用户名（根据token结构调整字段名）\r\n              if (decodedPayload.key) {\r\n                username = decodedPayload.key.replace('user_', ''); // 移除'user_'前缀\r\n              }\r\n            }\r\n          } catch (parseError) {\r\n            console.warn('解析token失败，使用登录时的用户名:', parseError);\r\n          }\r\n          \r\n          // 调用用户信息接口获取详细信息\r\n          try {\r\n            await userAPI.getUserInfo(username);\r\n          } catch (infoError) {\r\n            console.error('获取用户信息失败:', infoError);\r\n            // 即使获取用户信息失败，也继续登录流程，避免影响用户体验\r\n          }\r\n        }\r\n\r\n        // 记住用户信息\r\n        if (this.isRememberMe) {\r\n          uni.setStorageSync(\"rememberedUser\", {\r\n            username: this.loginForm.username,\r\n          });\r\n        } else {\r\n          uni.removeStorageSync(\"rememberedUser\");\r\n        }\r\n\r\n        uni.showToast({\r\n          title: result.msg || \"登录成功\",\r\n          icon: \"success\",\r\n        });\r\n\r\n        setTimeout(() => {\r\n          // 登录成功后跳转到首页\r\n          uni.reLaunch({\r\n            url: \"/pages/index/index\",\r\n          });\r\n        }, 1000);\r\n      } catch (error) {\r\n        console.error(\"登录错误:\", error);\r\n        uni.showToast({\r\n          title: error.message || \"网络错误，请稍后重试\",\r\n          icon: \"none\",\r\n        });\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    // 处理记住我选项变化\r\n    handleRememberChange(e) {\r\n      this.isRememberMe = e.target.checked;\r\n    },\r\n\r\n    handleForgotPassword() {\r\n      uni.showToast({\r\n        title: \"功能开发中\",\r\n        icon: \"none\",\r\n      });\r\n    },\r\n\r\n    goToRegister() {\r\n      uni.navigateTo({\r\n        url: \"/pages/register/register\",\r\n      });\r\n    },\r\n\r\n    handleSocialLogin(type) {\r\n      uni.showToast({\r\n        title: `${type}登录功能开发中`,\r\n        icon: \"none\",\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-container {\r\n  min-height: 100vh;\r\n  background-color: #ffffff;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 100rpx 60rpx 0;\r\n}\r\n\r\n.login-header {\r\n  text-align: center;\r\n  margin-bottom: 80rpx;\r\n\r\n  .logo-container {\r\n    display: flex;\r\n    justify-content: center;\r\n    margin-bottom: 20rpx;\r\n\r\n    .brain-logo {\r\n      width: 160rpx;\r\n      height: 160rpx;\r\n      background-color: #f0f4ff;\r\n      border-radius: 32rpx;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n\r\n      image {\r\n        width: 80rpx;\r\n        height: 80rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .app-title {\r\n    font-size: 42rpx;\r\n    color: #333333;\r\n    font-weight: 600;\r\n  }\r\n}\r\n\r\n.login-form {\r\n  width: 100%;\r\n\r\n  .form-item {\r\n    margin-bottom: 32rpx;\r\n\r\n    .form-input {\r\n      width: 100%;\r\n      height: 88rpx;\r\n      border: 2rpx solid #e0e0e0;\r\n      border-radius: 16rpx;\r\n      padding: 0 40rpx;\r\n      font-size: 30rpx;\r\n      color: #333;\r\n      background: #ffffff;\r\n      box-sizing: border-box;\r\n\r\n      &:focus {\r\n        border-color: #5374f7;\r\n      }\r\n    }\r\n  }\r\n\r\n  .form-options {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 40rpx;\r\n\r\n    .remember-container {\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      .remember-checkbox {\r\n        transform: scale(0.8);\r\n        margin-right: 8rpx;\r\n      }\r\n\r\n      .remember-text {\r\n        font-size: 28rpx;\r\n        color: #666;\r\n      }\r\n    }\r\n\r\n    .forgot-password {\r\n      font-size: 28rpx;\r\n      color: #5374f7;\r\n    }\r\n  }\r\n\r\n  .login-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background-color: #5374f7;\r\n    color: #ffffff;\r\n    border: none;\r\n    border-radius: 16rpx;\r\n    font-size: 32rpx;\r\n    font-weight: 600;\r\n    margin-bottom: 30rpx;\r\n  }\r\n\r\n  .register-link {\r\n    text-align: center;\r\n    font-size: 28rpx;\r\n    color: #666;\r\n    margin-bottom: 40rpx;\r\n\r\n    .link-text {\r\n      color: #5374f7;\r\n    }\r\n  }\r\n\r\n  .divider {\r\n    text-align: center;\r\n    font-size: 26rpx;\r\n    color: #999;\r\n    margin-bottom: 30rpx;\r\n\r\n    text {\r\n      position: relative;\r\n      padding: 0 20rpx;\r\n\r\n      &::before,\r\n      &::after {\r\n        content: \"\";\r\n        position: absolute;\r\n        top: 50%;\r\n        width: 120rpx;\r\n        height: 1rpx;\r\n        background-color: #e0e0e0;\r\n      }\r\n\r\n      &::before {\r\n        left: -120rpx;\r\n      }\r\n\r\n      &::after {\r\n        right: -120rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .social-login {\r\n    display: flex;\r\n    justify-content: center;\r\n    gap: 40rpx;\r\n\r\n    .social-btn {\r\n      width: 80rpx;\r\n      height: 80rpx;\r\n      border: 2rpx solid #e0e0e0;\r\n      border-radius: 16rpx;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      font-size: 36rpx;\r\n\r\n      &:nth-child(1) {\r\n        color: #3b5998;\r\n      }\r\n\r\n      &:nth-child(2) {\r\n        color: #db4437;\r\n      }\r\n\r\n      &:nth-child(3) {\r\n        color: #000;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/programming/Uniapp/aiNote/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","userAPI","setToken"],"mappings":"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"}