{"version":3,"file":"user.js","sources":["api/user.js"],"sourcesContent":["// 用户相关接口函数\n\nimport { http, setToken } from '../utils/request';\n\n/**\n * 用户登录\n * @param {Object} loginForm - 登录表单数据\n * @param {string} loginForm.username - 用户名\n * @param {string} loginForm.password - 密码\n * @returns {Promise} 返回登录结果\n */\nexport async function userLogin(loginForm) {\n  try {\n    const res = await http.post('/user/login', loginForm);\n    // 保存token\n    if (res.data && res.data.token) {\n      setToken(res.data.token);\n      // 保存用户信息\n      uni.setStorageSync('userInfo', res.data.userInfo || {});\n    }\n    return res;\n  } catch (error) {\n    console.error('登录失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 用户注册\n * @param {Object} registerForm - 注册表单数据\n * @param {string} registerForm.username - 用户名\n * @param {string} registerForm.password - 密码\n * @param {string} registerForm.email - 邮箱\n * @param {string} registerForm.code - 验证码\n * @param {number} [registerForm.permId=1] - 权限ID（可选）\n * @returns {Promise} 返回注册结果\n */\nexport async function userRegister(registerForm) {\n  try {\n    const res = await http.post('/user/register', registerForm);\n    return res;\n  } catch (error) {\n    console.error('注册失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 获取用户信息\n * @param {string} userName - 用户名\n * @returns {Promise} 返回用户信息\n */\nexport async function getUserInfo(userName) {\n  try {\n    const res = await http.get(`/user/getUserInfo?userName=${encodeURIComponent(userName)}`, {}, { needLogin: true });\n    // 更新本地存储的用户信息\n    if (res.data) {\n      uni.setStorageSync('userInfo', res.data);\n    }\n    return res;\n  } catch (error) {\n    console.error('获取用户信息失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 发送邮箱验证码\n * @param {string} email - 邮箱地址\n * @returns {Promise} 返回发送结果\n */\nexport async function sendEmailCode(email) {\n  try {\n    const res = await http.get(`/user/getEmail_code?email=${encodeURIComponent(email)}`, {});\n    return res;\n  } catch (error) {\n    console.error('发送验证码失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 更新用户信息\n * @param {Object} updateUserForm - 更新用户信息表单数据\n * @param {string} [updateUserForm.name] - 用户姓名（可选）\n * @param {string} [updateUserForm.username] - 用户名（可选）\n * @param {string} [updateUserForm.email] - 邮箱（可选）\n * @param {string} [updateUserForm.phone] - 手机号（可选）\n * @param {string} [updateUserForm.avatar] - 头像URL（可选）\n * @param {number} [updateUserForm.count] - 计数（可选）\n * @param {string} [updateUserForm.idNumber] - 身份证号（可选）\n * @param {number} [updateUserForm.uid] - 用户ID（可选）\n * @returns {Promise} 返回更新结果\n */\nexport async function updateUserInfo(updateUserForm) {\n  try {\n    const res = await http.put('/user/updateUserInfo', updateUserForm, { needLogin: true });\n    // 更新本地存储的用户信息\n    if (res.data) {\n      const currentUserInfo = uni.getStorageSync('userInfo') || {};\n      uni.setStorageSync('userInfo', updateUserForm);\n    }\n    return res;\n  } catch (error) {\n    console.error('更新用户信息失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 退出登录\n */\nexport function logout() {\n  // 清除token和用户信息\n  uni.removeStorageSync('token');\n  uni.removeStorageSync('userInfo');\n  // 跳转到登录页\n  uni.navigateTo({ url: '/pages/login/login' });\n}\n\n/**\n * 获取本地存储的用户信息\n * @returns {Object} 用户信息\n */\nexport function getLocalUserInfo() {\n  return uni.getStorageSync('userInfo') || {};\n}\n\n/**\n * 检查是否已登录\n * @returns {boolean} 是否已登录\n */\nexport function isUserLoggedIn() {\n  const token = uni.getStorageSync('token');\n  return !!token;\n}"],"names":["http","setToken","uni"],"mappings":";;;AAWO,eAAe,UAAU,WAAW;AACzC,MAAI;AACF,UAAM,MAAM,MAAMA,cAAI,KAAC,KAAK,eAAe,SAAS;AAEpD,QAAI,IAAI,QAAQ,IAAI,KAAK,OAAO;AAC9BC,oBAAAA,SAAS,IAAI,KAAK,KAAK;AAEvBC,oBAAG,MAAC,eAAe,YAAY,IAAI,KAAK,YAAY,CAAA,CAAE;AAAA,IACvD;AACD,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,4DAAc,SAAS,KAAK;AAC5B,UAAM;AAAA,EACP;AACH;AAYO,eAAe,aAAa,cAAc;AAC/C,MAAI;AACF,UAAM,MAAM,MAAMF,cAAI,KAAC,KAAK,kBAAkB,YAAY;AAC1D,WAAO;AAAA,EACR,SAAQ,OAAO;AACdE,4DAAc,SAAS,KAAK;AAC5B,UAAM;AAAA,EACP;AACH;AAOO,eAAe,YAAY,UAAU;AAC1C,MAAI;AACF,UAAM,MAAM,MAAMF,cAAAA,KAAK,IAAI,8BAA8B,mBAAmB,QAAQ,CAAC,IAAI,CAAE,GAAE,EAAE,WAAW,KAAM,CAAA;AAEhH,QAAI,IAAI,MAAM;AACZE,oBAAAA,MAAI,eAAe,YAAY,IAAI,IAAI;AAAA,IACxC;AACD,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,qBAAc,aAAa,KAAK;AAChC,UAAM;AAAA,EACP;AACH;AAOO,eAAe,cAAc,OAAO;AACzC,MAAI;AACF,UAAM,MAAM,MAAMF,mBAAK,IAAI,6BAA6B,mBAAmB,KAAK,CAAC,IAAI,CAAA,CAAE;AACvF,WAAO;AAAA,EACR,SAAQ,OAAO;AACdE,kBAAA,MAAA,MAAA,SAAA,qBAAc,YAAY,KAAK;AAC/B,UAAM;AAAA,EACP;AACH;AAeO,eAAe,eAAe,gBAAgB;AACnD,MAAI;AACF,UAAM,MAAM,MAAMF,cAAI,KAAC,IAAI,wBAAwB,gBAAgB,EAAE,WAAW,KAAI,CAAE;AAEtF,QAAI,IAAI,MAAM;AACZ,YAAM,kBAAkBE,cAAG,MAAC,eAAe,UAAU,KAAK,CAAA;AAC1DA,oBAAAA,MAAI,eAAe,YAAY,cAAc;AAAA,IAC9C;AACD,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,sBAAc,aAAa,KAAK;AAChC,UAAM;AAAA,EACP;AACH;AAKO,SAAS,SAAS;AAEvBA,sBAAI,kBAAkB,OAAO;AAC7BA,sBAAI,kBAAkB,UAAU;AAEhCA,gBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAC9C;AAMO,SAAS,mBAAmB;AACjC,SAAOA,oBAAI,eAAe,UAAU,KAAK,CAAA;AAC3C;AAMO,SAAS,iBAAiB;AAC/B,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,SAAO,CAAC,CAAC;AACX;;;;;;;;;"}