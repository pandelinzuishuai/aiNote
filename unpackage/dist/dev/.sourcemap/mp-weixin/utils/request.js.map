{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// 网络请求工具类\n\n// API基础URL\n// const BASE_URL = 'http://192.168.249.197:8080';//杨家标热点\nconst BASE_URL = 'http://192.168.43.150:8080';//潘德林热点\n// const BASE_URL = 'http://139.9.179.161:8088';//服务器ip\n\n// 请求超时时间\nconst TIMEOUT = 30000;\n\n// 获取token\nfunction getToken() {\n  return uni.getStorageSync('token');\n}\n\n// 设置token\nfunction setToken(token) {\n  uni.setStorageSync('token', token);\n}\n\n// 清除token\nfunction clearToken() {\n  uni.removeStorageSync('token');\n}\n\n// 检查是否已登录\nfunction isLoggedIn() {\n  return !!getToken();\n}\n\n// 网络请求函数\nfunction request(options = {}) {\n  return new Promise((resolve, reject) => {\n    // 检查是否需要登录但未登录\n    if (options.needLogin && !isLoggedIn()) {\n      uni.navigateTo({ url: '/pages/login/login' });\n      reject(new Error('请先登录'));\n      return;\n    }\n\n    // 构建请求配置\n    const config = {\n      url: `${BASE_URL}${options.url}`,\n      method: options.method || 'GET',\n      timeout: options.timeout || TIMEOUT,\n      header: {\n        'content-type': options.contentType || 'application/json',\n        ...options.header\n      },\n      data: options.data || {},\n      success: (res) => {\n        // 处理响应\n        console.log(res)\n        handleResponse(res, resolve, reject);\n      },\n      fail: (err) => {\n        // 处理失败\n        handleRequestError(err, reject);\n      }\n    };\n\n    // 添加token（如果有）\n    const token = getToken();\n    if (token) {\n      config.header['Authorization'] = `Bearer ${token}`;\n    }\n\n    // 发送请求\n    uni.request(config);\n  });\n}\n\n// 处理响应\nfunction handleResponse(res, resolve, reject) {\n  const { statusCode, data } = res;\n\n  // 处理HTTP状态码\n  if (statusCode === 200) {\n    // 处理业务逻辑\n    if (data.code === 200) {\n      // 请求成功\n      resolve(data);\n    } else if (data.code === 401) {\n      // Token过期或无效\n      clearToken();\n      uni.navigateTo({ url: '/pages/login/login' });\n      reject(new Error('登录已过期，请重新登录'));\n    } else {\n      // 业务错误\n      uni.showToast({\n        title: data.msg || '请求失败',\n        icon: 'none'\n      });\n      reject(new Error(data.msg || '业务处理失败'));\n    }\n  } else if (statusCode === 401) {\n    // Token过期或无效\n    clearToken();\n    uni.navigateTo({ url: '/pages/login/login' });\n    reject(new Error('登录已过期，请重新登录'));\n  } else if (statusCode === 403) {\n    uni.showToast({\n      title: '没有权限访问',\n      icon: 'none'\n    });\n    reject(new Error('权限不足'));\n  } else if (statusCode === 404) {\n    uni.showToast({\n      title: '请求的资源不存在',\n      icon: 'none'\n    });\n    reject(new Error('资源不存在'));\n  } else if (statusCode === 500) {\n    uni.showToast({\n      title: '服务器内部错误',\n      icon: 'none'\n    });\n    reject(new Error('服务器错误'));\n  } else {\n    uni.showToast({\n      title: `请求失败: ${statusCode}`,\n      icon: 'none'\n    });\n    reject(new Error(`HTTP错误: ${statusCode}`));\n  }\n}\n\n// 处理请求失败\nfunction handleRequestError(err, reject) {\n  // 网络错误处理\n  uni.showToast({\n    title: '网络连接失败，请检查网络设置',\n    icon: 'none'\n  });\n  console.error('请求失败:', err);\n  reject(new Error('网络连接失败'));\n}\n\n// 导出常用请求方法\nconst http = {\n  get: (url, data = {}, options = {}) => {\n    return request({ url, method: 'GET', data, ...options });\n  },\n  post: (url, data = {}, options = {}) => {\n    return request({ url, method: 'POST', data, ...options });\n  },\n  put: (url, data = {}, options = {}) => {\n    return request({ url, method: 'PUT', data, ...options });\n  },\n  delete: (url, data = {}, options = {}) => {\n    return request({ url, method: 'DELETE', data, ...options });\n  }\n};\n\n// 导出工具函数\nexport {\n  http,\n  getToken,\n  setToken,\n  clearToken,\n  isLoggedIn\n};\n\nexport default http;"],"names":["uni"],"mappings":"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"}