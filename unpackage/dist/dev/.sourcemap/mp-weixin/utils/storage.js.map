{"version":3,"file":"storage.js","sources":["utils/storage.js"],"sourcesContent":["/**\n * 存储相关工具函数\n * 用于管理用户token、用户信息等数据的本地存储\n */\n\n// 存储键名常量\nconst STORAGE_KEYS = {\n  TOKEN: 'token',\n  USER_INFO: 'userInfo',\n  REMEMBER_ME: 'remember_me',\n  USER_ID: 'userId'\n};\n\n/**\n * 存储token\n * @param {string} token - 用户token\n */\nexport function setToken(token) {\n  try {\n    uni.setStorageSync(STORAGE_KEYS.TOKEN, token);\n  } catch (e) {\n    console.error('存储token失败:', e);\n  }\n}\n\n/**\n * 获取token\n * @returns {string|null} token值或null\n */\nexport function getToken() {\n  try {\n    return uni.getStorageSync(STORAGE_KEYS.TOKEN);\n  } catch (e) {\n    console.error('获取token失败:', e);\n    return null;\n  }\n}\n\n/**\n * 删除token\n */\nexport function removeToken() {\n  try {\n    uni.removeStorageSync(STORAGE_KEYS.TOKEN);\n  } catch (e) {\n    console.error('删除token失败:', e);\n  }\n}\n\n/**\n * 存储用户信息\n * @param {object} userInfo - 用户信息对象\n */\nexport function setUserInfo(userInfo) {\n  try {\n    uni.setStorageSync(STORAGE_KEYS.USER_INFO, JSON.stringify(userInfo));\n  } catch (e) {\n    console.error('存储用户信息失败:', e);\n  }\n}\n\n/**\n * 获取用户信息\n * @returns {object|null} 用户信息对象或null\n */\nexport function getUserInfo() {\n  try {\n    const userInfo = uni.getStorageSync(STORAGE_KEYS.USER_INFO);\n    console.log('userInfo', userInfo)\n    return userInfo;\n  } catch (e) {\n    console.error('获取用户信息失败:', e);\n    return null;\n  }\n}\n\n/**\n * 删除用户信息\n */\nexport function removeUserInfo() {\n  try {\n    uni.removeStorageSync(STORAGE_KEYS.USER_INFO);\n  } catch (e) {\n    console.error('删除用户信息失败:', e);\n  }\n}\n\n/**\n * 设置记住密码状态\n * @param {boolean} remember - 是否记住密码\n * @param {object} credentials - 用户凭证（包含邮箱和密码）\n */\nexport function setRememberCredentials(remember, credentials = {}) {\n  try {\n    const data = {\n      remember,\n      credentials: remember ? credentials : null\n    };\n    uni.setStorageSync(STORAGE_KEYS.REMEMBER_ME, JSON.stringify(data));\n  } catch (e) {\n    console.error('设置记住密码状态失败:', e);\n  }\n}\n\n/**\n * 获取记住的用户凭证\n * @returns {object|null} 记住的凭证信息或null\n */\nexport function getRememberCredentials() {\n  try {\n    const data = uni.getStorageSync(STORAGE_KEYS.REMEMBER_ME);\n    if (data) {\n      const parsed = JSON.parse(data);\n      return parsed.remember ? parsed.credentials : null;\n    }\n    return null;\n  } catch (e) {\n    console.error('获取记住的凭证失败:', e);\n    return null;\n  }\n}\n\n/**\n * 存储用户ID\n * 同时更新userInfo中的uid属性\n * @param {string|number} userId - 用户ID\n */\nexport function setUserId(userId) {\n  try {\n    // 为了兼容性，仍然保存userId\n    uni.setStorageSync(STORAGE_KEYS.USER_ID, userId);\n    \n    // 同时更新userInfo中的uid属性\n    const userInfo = getUserInfo();\n    if (userInfo && typeof userInfo === 'object') {\n      // 创建新的userInfo对象，避免直接修改原对象\n      const updatedUserInfo = { ...userInfo, uid: userId };\n      setUserInfo(updatedUserInfo);\n    }\n  } catch (e) {\n    console.error('存储用户ID失败:', e);\n  }\n}\n\n/**\n * 获取用户ID\n * 从userInfo中获取uid属性\n * @returns {string|number|null} 用户ID或null\n */\nexport function getUserId() {\n  try {\n    const userInfo = getUserInfo();\n    // 确保userInfo是对象并且包含uid属性\n    if (userInfo && typeof userInfo === 'object' && 'uid' in userInfo) {\n      return userInfo.uid;\n    }\n    // 为了兼容，当userInfo中没有uid时，尝试从userId存储键获取\n    return uni.getStorageSync(STORAGE_KEYS.USER_ID);\n  } catch (e) {\n    console.error('获取用户ID失败:', e);\n    return null;\n  }\n}\n\n/**\n * 删除用户ID\n * 同时从userInfo中移除uid属性\n */\nexport function removeUserId() {\n  try {\n    // 删除userId存储键\n    uni.removeStorageSync(STORAGE_KEYS.USER_ID);\n    \n    // 同时从userInfo中移除uid属性\n    const userInfo = getUserInfo();\n    if (userInfo && typeof userInfo === 'object' && 'uid' in userInfo) {\n      // 创建新的userInfo对象，移除uid属性\n      const { uid, ...updatedUserInfo } = userInfo;\n      setUserInfo(updatedUserInfo);\n    }\n  } catch (e) {\n    console.error('删除用户ID失败:', e);\n  }\n}\n\n/**\n * 清除所有用户相关的本地数据\n */\nexport function clearUserData() {\n  removeToken();\n  removeUserInfo();\n  removeUserId();\n}"],"names":["uni"],"mappings":";;AAMA,MAAM,eAAe;AAAA,EACnB,OAAO;AAAA,EACP,WAAW;AAAA,EACX,aAAa;AAAA,EACb,SAAS;AACX;AAkBO,SAAS,WAAW;AACzB,MAAI;AACF,WAAOA,oBAAI,eAAe,aAAa,KAAK;AAAA,EAC7C,SAAQ,GAAG;AACVA,kBAAA,MAAA,MAAA,SAAA,0BAAc,cAAc,CAAC;AAC7B,WAAO;AAAA,EACR;AACH;AAKO,SAAS,cAAc;AAC5B,MAAI;AACFA,kBAAAA,MAAI,kBAAkB,aAAa,KAAK;AAAA,EACzC,SAAQ,GAAG;AACVA,kBAAA,MAAA,MAAA,SAAA,0BAAc,cAAc,CAAC;AAAA,EAC9B;AACH;AAMO,SAAS,YAAY,UAAU;AACpC,MAAI;AACFA,kBAAG,MAAC,eAAe,aAAa,WAAW,KAAK,UAAU,QAAQ,CAAC;AAAA,EACpE,SAAQ,GAAG;AACVA,iEAAc,aAAa,CAAC;AAAA,EAC7B;AACH;AAMO,SAAS,cAAc;AAC5B,MAAI;AACF,UAAM,WAAWA,cAAG,MAAC,eAAe,aAAa,SAAS;AAC1DA,kBAAAA,MAAY,MAAA,OAAA,0BAAA,YAAY,QAAQ;AAChC,WAAO;AAAA,EACR,SAAQ,GAAG;AACVA,iEAAc,aAAa,CAAC;AAC5B,WAAO;AAAA,EACR;AACH;AAKO,SAAS,iBAAiB;AAC/B,MAAI;AACFA,kBAAAA,MAAI,kBAAkB,aAAa,SAAS;AAAA,EAC7C,SAAQ,GAAG;AACVA,iEAAc,aAAa,CAAC;AAAA,EAC7B;AACH;AAgEO,SAAS,YAAY;AAC1B,MAAI;AACF,UAAM,WAAW;AAEjB,QAAI,YAAY,OAAO,aAAa,YAAY,SAAS,UAAU;AACjE,aAAO,SAAS;AAAA,IACjB;AAED,WAAOA,oBAAI,eAAe,aAAa,OAAO;AAAA,EAC/C,SAAQ,GAAG;AACVA,kEAAc,aAAa,CAAC;AAC5B,WAAO;AAAA,EACR;AACH;AAMO,SAAS,eAAe;AAC7B,MAAI;AAEFA,kBAAAA,MAAI,kBAAkB,aAAa,OAAO;AAG1C,UAAM,WAAW;AACjB,QAAI,YAAY,OAAO,aAAa,YAAY,SAAS,UAAU;AAEjE,YAAM,EAAE,KAAK,GAAG,gBAAe,IAAK;AACpC,kBAAY,eAAe;AAAA,IAC5B;AAAA,EACF,SAAQ,GAAG;AACVA,kEAAc,aAAa,CAAC;AAAA,EAC7B;AACH;AAKO,SAAS,gBAAgB;AAC9B;AACA;AACA;AACF;;;;;"}